<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<packaging>pom</packaging>
	<parent>
		<artifactId>opennaas</artifactId>
		<groupId>org.opennaas</groupId>
		<version>1.0.0-SNAPSHOT</version>
	</parent>
	<name>OpenNaaS platform</name>
	<artifactId>platform</artifactId>
	<!--  properties to use fuse  -->
	<properties>
		<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
		<target-platform.path>target/opennaas</target-platform.path>
		<servicemix.path>apache-servicemix-${servicemix.version}</servicemix.path>
		<!-- Using this as 2.2 up to and including 2.2.0-fuse-00-43 gave us nightmares. Let's try 2.2+ versions again sometime.-->
		<karaf.version>2.1.4-fuse-00-22</karaf.version>
		<servicemix.version>4.4.0-fuse-00-43</servicemix.version>
	</properties>
	<repositories>
		<repository>
			<id>fusesource</id>
			<name>Fuse Source releases</name>
			<url>http://repo.fusesource.com/maven2/</url>
		</repository>
	</repositories>
	<pluginRepositories>
		<pluginRepository>
			<id>fusesource</id>
			<name>Fuse Source releases</name>
			<url>http://repo.fusesource.com/maven2/</url>
		</pluginRepository>
	</pluginRepositories>
	<dependencies>
		<dependency>
			<groupId>org.apache.servicemix</groupId>
			<artifactId>apache-servicemix</artifactId>
			<type>pom</type>
			<version>${servicemix.version}</version>
		</dependency>
		<!-- Karaf -->
		<dependency>
			<groupId>org.apache.karaf.shell</groupId>
			<artifactId>org.apache.karaf.shell.console</artifactId>
			<version>${karaf.version}</version>
		</dependency>
		<dependency>
			<groupId>org.apache.karaf.jaas</groupId>
			<artifactId>org.apache.karaf.jaas.boot</artifactId>
			<version>${karaf.version}</version>
		</dependency>
		<dependency>
			<groupId>org.apache.karaf.jaas</groupId>
			<artifactId>org.apache.karaf.jaas.config</artifactId>
			<version>${karaf.version}</version>
		</dependency>
		<dependency>
			<groupId>org.apache.karaf.jaas</groupId>
			<artifactId>org.apache.karaf.jaas.modules</artifactId>
			<version>${karaf.version}</version>
		</dependency>
		<dependency>
			<groupId>org.apache.karaf.tooling</groupId>
			<artifactId>org.apache.karaf.tooling.testing</artifactId>
			<version>${karaf.version}</version>
		</dependency>
		<dependency>
			<groupId>org.opennaas</groupId>
			<artifactId>opennaas-core-karafbranding</artifactId>
			<version>1.0.0-SNAPSHOT</version>
		</dependency>
	</dependencies>
	<!--
  | imported (non-local) bundles are listed here as dependencies | and
  will be deployed by pax:provision unless they are marked | with
  <optional>true</optional>
 -->
	<build>
		<resources>
			<resource>
				<directory>${pom.basedir}/src/main/filtered-resources</directory>
				<filtering>true</filtering>
				<includes>
					<include>**/*</include>
				</includes>
			</resource>
		</resources>
		<plugins>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-dependency-plugin</artifactId>
				<executions>
					<execution>
						<id>unpack-apache-servicemix</id>
						<phase>package</phase>
						<goals>
							<goal>unpack</goal>
						</goals>
						<configuration>
							<artifactItems>
								<artifactItem>
									<groupId>org.apache.servicemix</groupId>
									<artifactId>apache-servicemix</artifactId>
									<version>${fuse.version}</version>
								</artifactItem>
							</artifactItems>
							<outputDirectory>${target-platform.path}</outputDirectory>
							<overWriteIfNewer>true</overWriteIfNewer>
							<excludes>**\/bin\/servicemix,**\/bin\/servicemix.bat</excludes>
							<!--<chmod file="${target-platform.path}/${servicemix.path}/bin/*" perm="ugo+rx" />-->
						</configuration>
					</execution>
					<execution>
						<id>copy-karafbranding</id>
						<phase>package</phase>
						<goals>
							<goal>copy</goal>
						</goals>
						<configuration>
							<artifactItems>
								<artifactItem>
									<groupId>org.opennaas</groupId>
									<artifactId>opennaas-core-karafbranding</artifactId>
								</artifactItem>
							</artifactItems>
							<outputDirectory>${target-platform.path}/${servicemix.path}/lib</outputDirectory>
							<overWriteIfNewer>true</overWriteIfNewer>
						</configuration>
					</execution>
					<!--<execution>
						<id>get-nexus-feature</id>
						<phase>package</phase>
						<goals>
							<goal>copy</goal>
						</goals>
						<configuration>
							<artifactItems>
								<artifactItem>
									<artifactId>nexus-fuse</artifactId>
									<groupId>net.i2cat.nexus</groupId>
									<version>1.0.0-SNAPSHOT</version>
									<type>xml</type>
									<classifier>features</classifier>
								</artifactItem>
							</artifactItems>
							<outputDirectory>${target-platform.path}/${servicemix.path}/system/net/i2cat/nexus/nexus-fuse/1.0.0-SNAPSHOT/</outputDirectory>
							<overWriteIfNewer>true</overWriteIfNewer>
						</configuration>
					</execution>
					<execution>
						<id>get-mantychore-feature</id>
						<phase>package</phase>
						<goals>
							<goal>copy</goal>
						</goals>
						<configuration>
							<artifactItems>
								<artifactItem>
									<artifactId>mantychore</artifactId>
									<groupId>net.i2cat.mantychore</groupId>
									<version>1.0.0-SNAPSHOT</version>
									<type>xml</type>
									<classifier>features</classifier>
								</artifactItem>
							</artifactItems>
							<outputDirectory>${target-platform.path}/${servicemix.path}/system/net/i2cat/mantychore/mantychore/1.0.0-SNAPSHOT/</outputDirectory>
							<overWriteIfNewer>true</overWriteIfNewer>
						</configuration>
					</execution>-->
				</executions>
			</plugin>
			<!--<plugin>
				<groupId>org.apache.felix.karaf.tooling</groupId>
				<artifactId>features-maven-plugin</artifactId>
				<version>1.4.0-fuse-02-00</version>
				<executions>
					<execution>
						<id>add-features-to-repo</id>
						<phase>generate-resources</phase>
						<goals>
							<goal>add-features-to-repo</goal>
						</goals>
						<configuration>
							<descriptors>
								<descriptor>mvn:net.i2cat.mantychore/mantychore/1.0.0-SNAPSHOT/xml/features</descriptor>
							</descriptors>
							<features>
								<feature>i2cat-mantychore-deps</feature>
								<feature>i2cat-mantychore-core</feature>
							</features>
							<repository>${target-platform.path}/${servicemix.path}/system</repository>
						</configuration>
					</execution>
				</executions>
			</plugin>-->
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-resources-plugin</artifactId>
				<version>2.4</version>
				<executions>
					<!-- process the resources to resolve the version variables -->
					<execution>
						<id>filter-resources</id>
						<goals>
							<goal>resources</goal>
						</goals>
						<phase>process-resources</phase>
						<configuration>
							<!-- specify UTF-8, ISO-8859-1 or any other file encoding -->
							<encoding>UTF-8</encoding>
						</configuration>
					</execution>
					<execution>
						<id>install-opennaas-configs</id>
						<phase>package</phase>
						<goals>
							<goal>copy-resources</goal>
						</goals>
						<configuration>
							<outputDirectory>${target-platform.path}/${servicemix.path}</outputDirectory>
							<!--  
      <resources>
		  <resource>
		    <directory>src/main/java</directory>
		    <includes>
		      <include>**/*.xml</include>
		    </includes>
		  </resource>
	  </resources>
      -->
							<overwrite>true</overwrite>
							<outputDirectory>${target-platform.path}/${servicemix.path}</outputDirectory>
							<resources>
								<resource>
									<directory>target/classes</directory>
								</resource>
							</resources>
						</configuration>
					</execution>
					<!--  Try to copy the files under service mix into the root iaas dir and delete the service mix dir with the
     maven clean plugin... -->
				</executions>
			</plugin>
		</plugins>
	</build>
</project>
