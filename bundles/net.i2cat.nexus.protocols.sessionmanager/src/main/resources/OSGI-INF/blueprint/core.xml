<?xml version="1.0" encoding="UTF-8"?>

<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0">

	<bean id="protocolManager" class="net.i2cat.nexus.protocols.sessionmanager.impl.ProtocolManager" />

	<!-- Listen for registration / deregistration of IProtocolSessionFactory services -->
	<reference-list interface="net.i2cat.nexus.resources.protocol.IProtocolSessionFactory" availability="optional">
		<reference-listener ref="protocolManager"
			bind-method="sessionFactoryAdded" unbind-method="sessionFactoryRemoved" />
	</reference-list>

	<!-- Register a ProtocolManager as an OSGi Service -->
	<service ref="protocolManager"
		interface="net.i2cat.nexus.resources.protocol.IProtocolManager" />
	
	<!-- Provide commands to the Karaf shell -->
	<command-bundle xmlns="http://karaf.apache.org/xmlns/shell/v1.0.0">
		<command name="nexus/listProtocolFactories">
			<action class="net.i2cat.nexus.protocols.sessionmanager.shell.ListProtocolFactoriesCommand" />
		</command>
		<command name="nexus/listDevices">
			<action class="net.i2cat.nexus.protocols.sessionmanager.shell.ListDevicesCommand" />
		</command>					
		<command name="protocols/add">
			<action class="net.i2cat.nexus.protocols.sessionmanager.shell.AddCommand" />
		</command>
		<command name="protocols/purge">
			<action class="net.i2cat.nexus.protocols.sessionmanager.shell.PurgeCommand" />
		</command>
		<command name="protocols/context">
			<action class="net.i2cat.nexus.protocols.sessionmanager.shell.ContextCommand" />
		</command>
	</command-bundle>
</blueprint>